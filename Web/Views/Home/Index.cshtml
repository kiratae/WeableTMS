@using cntr = Weable.TMS.Web.Controllers.HomeController
@using System.Web
@model Weable.TMS.Web.Models.ListTrainingModel

@inject Weable.TMS.Model.ServiceModel.IFileService fileService

@{
    ViewData["Title"] = "หน้าแรก";
}

<style>
    .btn-training {
        cursor: pointer;
    }
</style>

<div class="container mb-5">

    <form action="/" method="GET">
        <div class="row mt-3">
            <div class="form-group col-6">
                <div class="input-group">
                    <input class="form-control" type="text" name="name" placeholder="ค้นหาการอบรม" />
                    <div class="input-group-append">
                        <span class="input-group-text">
                            <i class="fa fa-search"></i>
                        </span>
                    </div>
                </div>
            </div>
            <div class="form-group col-6 text-right">
                <button class="btn btn-outline-secondary" type="button">
                    <i class="fa fa-filter"></i>&ensp;ตัวกรอง
                </button>
            </div>
        </div>
    </form>

    <div class="row mt-3">

        @if (Model.Trainings.Count == 0)
        {
            <div class="col-12 mt-3 text-center">
                <img class="card-img-top" height="300" src="~/images/undraw_no_data_qbuo.svg" />
                <h3 class="mt-3">ไม่มีการฝึกอบรมในตอนนี้</h3>
            </div>
        }
        @foreach (var t in Model.Trainings)
        {
            string ImageUrl;
            if (t.TrnImage.HasValue)
            {
                ImageUrl = fileService.GetData(t.TrnImage.Value).Result.FileName;
            }
            else
            {
                ImageUrl = "~/images/1200x675.jpg";
            }
            string RegisUrl = Url.Action(cntr.ActionDetail, cntr.Name, new { id = t.TrainingId });
            <div class="col-md-4 col-sm-6 col-12">
                <div class="card shadow mb-2 btn-training" data-x-url="@RegisUrl">
                    <img class="card-img-top" src="@ImageUrl" />
                    <div class="card-body ">
                        <h5 class="card-title title">@t.Course.Name</h5>
                        @{
                            var closeText = "";
                            if (t.PublishAtdDate <= DateTime.Now)
                            {
                                closeText = "(ประกาศรายชื่อผู้มีสิทธิ์เข้าร่วมอบรม) ";
                            }
                        }
                        <p class="card-text">@closeText @t.Name</p>
                        <hr />

                        <div class="row no-gutters">
                            <div class="col-sm-4">วันที่จัดอบรม :</div>
                            <div class="col-sm-8 title">
                                @if (t.TrnStartDateText == t.TrnEndDateText)
                                {
                                    <span>@Model.FormatShortDate(t.TrnStartDate, t.TrnStartDate.Day.ToString(), t.TrnEndDate.Day.ToString())</span>
                                }
                                else if (t.TrnStartDate.Month.Equals(t.TrnEndDate.Month))
                                {
                                    <span>@t.TrnStartDateText</span>
                                }
                                else
                                {
                                    <span>@t.TrnStartDateText - @t.TrnEndDateText</span>
                                }
                            </div>
                        </div>
                        <div class="row no-gutters">
                            <div class="col-sm-4">สถานที่ :</div>
                            <div class="col-sm-8 title">@t.Location</div>
                        </div>
                        <div class="row no-gutters">
                            <div class="col-sm-4">สถานะ :</div>
                            @{
                                string StatusName = "-";
                                if (DateTime.Now.Date < t.RegisterStartDate)
                                {
                                    StatusName = "รอเปิดรับสมัคร";
                                }
                                if (t.RegisterStartDate <= DateTime.Now.Date && t.RegisterEndDate >= DateTime.Now.Date)
                                {
                                    if (t.AttendeeQty >= t.SeatQty)
                                    {
                                        StatusName = "มีผู้สมัครครบแล้ว";
                                    }
                                    else
                                    {
                                        StatusName = "กำลังเปิดรับสมัคร";
                                    }
                                }
                                if (t.RegisterEndDate < DateTime.Now.Date)
                                {
                                    StatusName = "ปิดรับสมัคร";
                                }
                                if (t.TrnEndDate < DateTime.Now.Date)
                                {
                                    StatusName = "จัดฝึกอบรมแล้ว";
                                }

                            }
                            <div class="col-sm-8 title">@StatusName</div>
                        </div>
                    </div>
                </div>
            </div>
        }
    </div>
</div>

@section Scripts {
    <script>
        $(document).ready(function () {
            $('.btn-training').click(function () {
                var url = $(this).data('x-url');
                location.href = url;
            });
        });
    </script>
}