@using cntr = Weable.TMS.Web.Controllers.RegisTrainingController
@model Weable.TMS.Web.Models.EditRegisTrainingModel

<script type="text/javascript">
    var canSubmit = false;
    var __return_url = '@Html.Raw(Model.ReturnUrl)';
    $(document).ready(function () {
        $('#validate').hide();

		$('#btn-search').click(function (e) {
			console.log("search click")
            e.preventDefault();
            if ($("#Identification").val() === "" || $("#VerifyCode").val() === "") {
                $('#validate').text("** กรุณากรอกข้อมูล **");
                $('#validate').show();
            } else if (!canSubmit) {
                $('#validate').text("** กรุณากด recaptcha **");
                $('#validate').show();
            } else {
                $('#validate').hide();
                var identification = $("#Identification").val();
                var verifyCode = $("#VerifyCode").val();
				var form = $('form[id=search]');//.submit();
				$.ajax({
					url: '@Url.Action(cntr.ActionCheckAllCondition, cntr.Name)',
					type: "POST",
					dataType: "json",
                    data: {
                        identification: identification,
                        verifyCode: verifyCode,
                        captcha: grecaptcha.getResponse(),
                        trainingId: '@Model.Training.TrainingId'
                    },
					success: function (data, textStatus, xhr) {
						if (data){
                            if (data.msgCode == 0) {
                                grecaptcha.reset();
								$('#validate').text("** " + data.msg +" **")
                            } else if (data.msgCode == 1) {
                                $('#search #CitizenId').val(data.citizenId);
								$(form).submit();
							}
						}
					}
				});
            }
        });

        $('#btn-cancel').click(function (e) {
            e.preventDefault();
            ReturnToMainPage()
        });
    });

    function recaptchaCallback() {
        canSubmit = true;
    }

    function ReturnToMainPage() {
        window.location.href = __return_url;
    }
</script>